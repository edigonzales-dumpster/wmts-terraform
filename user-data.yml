#cloud-config
users:
  - name: appuser
    shell: /bin/bash

package_upgrade: false

runcmd:
 - apt update
 - mkdir --mode=0777 /pgdata
 - usermod -aG docker appuser
 - su - appuser -c "docker swarm init --advertise-addr $(hostname -I | awk '{print $1}')" 
 - su - appuser -c "docker volume create portainer_data" 
 - su - appuser -c "docker run -d -p 8000:8000 -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer" 
